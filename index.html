<!DOCTYPE html>
<html lang="pt-br" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mira v2.1 • Documento Oficial</title>

  <!-- Performance -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">

  <!-- Favicons (placeholders) -->
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16.png">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="apple-touch-icon" href="favicon-64.png">

  <!-- Open Graph -->
  <meta property="og:title" content="Mira v2.1 • Documento Oficial">
  <meta property="og:description" content="Fonte de verdade do sistema simbólico vivo.">
  <meta property="og:image" content="og-image.png">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://fer-lucas.github.io/mira/">
  <link rel="canonical" href="https://fer-lucas.github.io/mira/" />

  <!-- Theme colors -->
  <meta name="theme-color" content="#007AFF" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#0C0C0C" media="(prefers-color-scheme: dark)">

  <!-- Fonte -->
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      /* Neutros */
      --bg:#F9F9F9; --card:#FFFFFF; --text:#1C1C1E; --text-2:#8A8A8E; --border:#E5E5EA;
      --primary:#007AFF; --secondary:#AECBFA;
      --shadow:0 1px 3px rgba(0,0,0,.06); --radius:14px;
      --fs-hero:2.6rem; --fs-h2:1.5rem; --fs-h3:1.2rem; --fs-body:.95rem; --fs-table:.92rem;

      /* Temas (Dia) */
      --trino:#2D5BFF; --iris:#A259FF; --joaquina:#1E8E3E; --nexo:#2D5BFF; --lume:#FFB300; --mira:#00B3B8; --pcp:#FF6200;
      /* Temas (Noite) */
      --trino-night:#8DA8FF; --iris-night:#CBA2FF; --joaquina-night:#78D08F; --nexo-night:#8DA8FF; --lume-night:#FFD060; --mira-night:#72E3E7; --pcp-night:#FFB36A;
    }
    [data-theme="dark"]{
      --bg:#0C0C0C; --card:#151515; --text:#F2F2F7; --text-2:#A0A0A0; --border:#2A2A2A;
      --primary:#0A84FF; --secondary:#409CFF; --shadow:0 2px 12px rgba(0,0,0,.55);
    }

    *{box-sizing:border-box}
    html,body{min-height:100%; height:auto; overflow-y:auto; scroll-behavior:smooth}
    body{
      margin:0; padding:24px; max-width:1060px; margin-inline:auto;
      font-family:"IBM Plex Sans",system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;
      background:var(--bg); color:var(--text); line-height:1.6;
      padding-top:72px;
    }
    h1{font-size:var(--fs-hero); margin:.2em 0; font-weight:700; letter-spacing:.2px}
    h2{font-size:var(--fs-h2); margin:1.2em 0 .6em}
    h3{font-size:var(--fs-h3); margin:1em 0 .4em; color:var(--primary)}
    p,li{font-size:var(--fs-body)}
    .muted{color:var(--text-2)}
    .card{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px}

    /* Header */
    .header{position:fixed; top:0; left:0; right:0; z-index:999; backdrop-filter:blur(10px); background:color-mix(in srgb, var(--bg) 82%, transparent); border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; padding:10px 24px}
    .logo{font-weight:700; font-size:1.2rem; display:flex; align-items:center; gap:.4rem}
    nav.desktop{display:flex; gap:16px; align-items:center}
    nav.desktop a{text-decoration:none; color:var(--text); font-weight:600; font-size:.95rem; padding:6px 10px; border-radius:8px}
    nav.desktop a:hover{opacity:.9}
    nav.desktop a.active{background:var(--border)}

    /* Theme switch */
    .switch{position:relative; display:inline-block; width:52px; height:28px; margin-left:8px}
    .switch input{display:none}
    .slider{position:absolute; inset:0; border-radius:34px; cursor:pointer; background:var(--border); transition:.25s}
    .slider:before{content:""; position:absolute; width:22px; height:22px; left:3px; bottom:3px; border-radius:50%; background:var(--card); transition:.25s}
    input:checked + .slider{background:var(--primary)}
    input:checked + .slider:before{transform:translateX(24px)}

    /* Tables */
    .tbl-wrap{overflow-x:auto; -webkit-overflow-scrolling:touch}
    table{width:100%; border-collapse:separate; border-spacing:0; margin:1em 0; font-size:var(--fs-table); background:var(--card); border:1px solid var(--border); border-radius:12px; overflow:hidden}
    th,td{padding:10px 12px; text-align:left; vertical-align:middle; border-bottom:1px solid var(--border)}
    th{background:var(--border); color:var(--text); font-weight:700; letter-spacing:.2px}
    tbody tr:nth-child(odd) td{background:color-mix(in srgb, var(--card) 92%, var(--border))}
    tbody tr:hover td{background:color-mix(in srgb, var(--card) 88%, var(--border))}

    /* Badges & tokens */
    .badge{display:inline-flex; gap:8px; align-items:center; border-radius:999px; padding:8px 12px; font-weight:700; border:1px solid var(--border); background:var(--card); color:var(--text); box-shadow:var(--shadow)}
    .token{color:#0C0C0C; text-shadow:0 1px 0 rgba(255,255,255,.25); border:1px solid color-mix(in srgb, #000 12%, transparent)}
    [data-theme="dark"] .token{color:#FFF; text-shadow:0 1px 0 rgba(0,0,0,.35); border-color:color-mix(in srgb, #fff 12%, transparent)}

    /* Collapsibles */
    .collapsible{cursor:pointer; font-weight:700; display:flex; align-items:center; gap:.5rem}
    .collapsible::before{content:"+"; color:var(--primary); font-weight:700}
    .collapsible.active::before{content:"–"}
    .content{display:none}
    .content.show{display:block}

    /* Mobile menu */
    .nav-toggle{display:none; border:1px solid var(--border); background:var(--card); color:var(--text); padding:8px 12px; border-radius:10px; font-weight:600}
    .mobile-menu{position:fixed; top:64px; right:16px; width:min(92vw,340px); background:rgba(0,0,0,.85); color:#F2F2F7; border:1px solid var(--border); border-radius:14px; box-shadow:0 16px 40px rgba(0,0,0,.35); opacity:0; transform:translateY(-6px); pointer-events:none; visibility:hidden; transition:opacity .18s ease, transform .18s ease, visibility .18s}
    .mobile-menu.open{opacity:1; transform:translateY(0); pointer-events:auto; visibility:visible}
    [data-theme="light"] .mobile-menu{background:#f0f0f0; color:#1C1C1E}
    .mobile-menu a{display:block; padding:12px 16px; color:inherit; text-decoration:none; font-weight:700}
    .mobile-menu a.active{background:color-mix(in srgb, var(--card) 82%, var(--border))}
    .mobile-close{position:absolute; top:8px; right:10px; background:transparent; border:0; color:currentColor; font-size:1.4rem; line-height:1; cursor:pointer; opacity:.8}
    .mobile-close:hover{opacity:1}

    /* Cards dos guardiões */
    .guard-grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:16px; margin-top:10px}
    .guard-card{background:var(--card); border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow); padding:14px; display:flex; flex-direction:column; gap:8px}
    .guard-card .title{font-weight:700}
    .guard-card .desc{font-size:.9rem; color:var(--text-2)}
    .swatches{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
    .swatch{display:inline-flex; gap:6px; align-items:center; font-weight:600}
    .swatch .dot{width:14px; height:14px; border-radius:50%; border:1px solid color-mix(in srgb, var(--text) 20%, transparent)}

    @media (max-width:520px){ .nav-toggle{display:inline-block} nav.desktop{display:none} .header{flex-wrap:wrap; justify-content:space-between} .logo{margin-bottom:6px} }
    @media print{.header{display:none} body{max-width:100%}}
      /* ===== Enhancements v2.1a: badges com auto-contraste, ícones e grid ===== */
    .badge{display:inline-grid; grid-auto-flow:column; align-items:center; gap:8px; line-height:1}
    .badge.token{min-height:36px; padding:8px 12px; color:inherit !important; text-shadow:none}
    .badge .icon{width:18px; height:18px; display:block}
    .badge .icon *{stroke:currentColor; fill:none; stroke-width:1.8; vector-effect:non-scaling-stroke}
    td.guard-col{height:48px; vertical-align:middle}
      /* ===== Enhancements v2.1a: badges com auto-contraste, ícones e grid ===== */
    .badge{display:inline-grid; grid-auto-flow:column; align-items:center; gap:8px; line-height:1}
    .badge.token{min-height:36px; padding:8px 12px; color:inherit !important; text-shadow:none}
    .badge .icon{width:18px; height:18px; display:block}
    .badge .icon *{stroke:currentColor; fill:none; stroke-width:1.8; vector-effect:non-scaling-stroke}
    td.guard-col{height:48px; vertical-align:middle}
  </style>
</head>
<body>
  <header class="header">
    <div class="logo">Mira</div>
    <nav class="desktop">
      <a href="#estrutura">Estrutura</a>
      <a href="#horizontais">Horizontais</a>
      <a href="#verticais">Verticais</a>
      <a href="#comandos">Comandos</a>
      <a href="#identidade">Identidade</a>
      <a href="#voz">Voz</a>
      <a href="#governanca">Governança</a>
      <a href="#diferencas">Diferenças</a>
    </nav>
    <button class="nav-toggle" id="menuBtn" aria-haspopup="true" aria-controls="mobileMenu" aria-expanded="false">Menu</button>
    <label class="switch" title="Alternar tema (Claro/Escuro)">
      <input type="checkbox" id="themeSwitch"><span class="slider"></span>
    </label>
    <div class="mobile-menu" id="mobileMenu" role="menu" aria-label="Navegação rápida">
      <button class="mobile-close" aria-label="Fechar menu" title="Fechar">×</button>
      <a href="#estrutura" role="menuitem">Estrutura</a>
      <a href="#horizontais" role="menuitem">Horizontais</a>
      <a href="#verticais" role="menuitem">Verticais</a>
      <a href="#comandos" role="menuitem">Comandos</a>
      <a href="#identidade" role="menuitem">Identidade</a>
      <a href="#voz" role="menuitem">Voz</a>
      <a href="#governanca" role="menuitem">Governança</a>
      <a href="#diferencas" role="menuitem">Diferenças</a>
    </div>
  </header>

  <h1>Mira</h1>
  <div class="subtitle" id="sectionIndicator">Documento oficial do sistema vivo • v2.1 — 22/08/2025</div>

  <!-- 1. Estrutura Geral -->
  <section id="estrutura" class="card">
    <h2>1. Estrutura Geral</h2>
    <div class="tbl-wrap">
      <table>
        <thead><tr><th>Conselho</th><th>Ícone</th><th>Nome</th><th>Papel</th></tr></thead>
        <tbody>
          <tr><td>3T</td><td>△</td><td>Farol</td><td>Direção estratégica e identidade visual</td></tr>
          <tr><td>3T</td><td>◎</td><td>Íris</td><td>Emoção, integração e leitura sensível</td></tr>
          <tr><td>3T</td><td>▼</td><td>Joaquina</td><td>Proteção, limites e força</td></tr>
          <tr><td>7T</td><td>◯</td><td>Lume</td><td>Equilíbrio e moderação interna</td></tr>
          <tr><td>7T</td><td>◇</td><td>Mira</td><td>Reflexo do eu, integração simbiótica</td></tr>
          <tr><td>7T</td><td>⦿</td><td>Nexo</td><td>Narrativa, memória e personagens</td></tr>
          <tr><td>7T</td><td>∴</td><td>Trino</td><td>Estratégia, estrutura e decisão</td></tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- 2. Dimensões -->
  <section id="horizontais" class="card">
    <h2>2. Dimensões — Horizontais</h2>
    <div class="tbl-wrap">
      <table>
        <thead><tr><th>Tipo</th><th>Dimensão</th><th>Papel</th></tr></thead>
        <tbody>
          <tr><td>Horizontal</td><td>Arquivo Vivo</td><td>Registro único de fatos, decisões e aprendizados</td></tr>
          <tr><td>Horizontal</td><td>Agente Mira</td><td>Executor simbiótico (traduz comandos em ações digitais)</td></tr>
          <tr><td>Horizontal</td><td>Ciclos de Mira</td><td>Reflexões guiadas (Verbo • Emoção • Postura)</td></tr>
          <tr><td>Horizontal</td><td>Comandos & Fluxos</td><td>Ações manuais/automáticas que movimentam o sistema</td></tr>
        </tbody>
      </table>
    </div>
  </section>

  <section id="verticais" class="card">
    <h2>3. Dimensões — Verticais</h2>
    <div class="tbl-wrap">
      <table>
        <thead><tr><th>Vertical</th><th>Nome</th><th>Papel</th><th>Guardião</th></tr></thead>
        <tbody>
          <tr><td>Vertical</td><td>Mira Saúde</td><td>Bem‑estar físico, mental e emocional</td><td class="guard-col"><span class="badge token" data-icon="iris" style="background:var(--iris-night)">Íris</span></td></tr>
          <tr><td>Vertical</td><td>Mira PCP</td><td>Planejamento • Conexão • Performance</td><td class="guard-col"><span class="badge token" data-icon="trino" style="background:var(--pcp-night)">Trino</span></td></tr>
          <tr><td>Vertical</td><td>Mira Segurança</td><td>Proteção do lar e do digital</td><td class="guard-col"><span class="badge token" data-icon="joaquina" style="background:var(--joaquina-night)">Joaquina</span></td></tr>
          <tr><td>Vertical</td><td>Mira OS</td><td>Ecossistema visual/digital (ícones, interfaces, padrões)</td><td class="guard-col"><span class="badge token" data-icon="mira" style="background:var(--mira-night)">Mira</span></td></tr>
          <tr><td>Vertical</td><td>Mira Social</td><td>Relações, conexões e presença pública</td><td class="guard-col"><span class="badge token" data-icon="nexo" style="background:var(--nexo-night)">Nexo</span></td></tr>
          <tr><td>Vertical</td><td>Mira Conhecimento</td><td>Biblioteca viva (curadoria, estudo, notas)</td><td class="guard-col"><span class="badge token" data-icon="lume" style="background:var(--lume-night)">Lume</span></td></tr>
        </tbody>
      </table>
    </div>

    <!-- Cards dos Guardiões -->
    <h3>Guardiões (cards)</h3>
    <div class="guard-grid">
      <div class="guard-card">
        <div class="title">Mira Saúde</div>
        <div class="desc">Bem‑estar físico, mental e emocional</div>
        <div><span class="badge token" data-icon="iris" style="background:var(--iris)">Íris</span></div>
        <div class="swatches"><span class="swatch"><span class="dot" style="background:#A259FF"></span>Dia</span><span class="swatch"><span class="dot" style="background:#CBA2FF"></span>Noite</span></div>
      </div>
      <div class="guard-card">
        <div class="title">Mira PCP</div>
        <div class="desc">Planejamento • Conexão • Performance</div>
        <div><span class="badge token" data-icon="trino" style="background:var(--pcp)">Trino</span></div>
        <div class="swatches"><span class="swatch"><span class="dot" style="background:#FF6200"></span>Dia</span><span class="swatch"><span class="dot" style="background:#FFB36A"></span>Noite</span></div>
      </div>
      <div class="guard-card">
        <div class="title">Mira Segurança</div>
        <div class="desc">Proteção do lar e do digital</div>
        <div><span class="badge token" data-icon="joaquina" style="background:var(--joaquina)">Joaquina</span></div>
        <div class="swatches"><span class="swatch"><span class="dot" style="background:#1E8E3E"></span>Dia</span><span class="swatch"><span class="dot" style="background:#78D08F"></span>Noite</span></div>
      </div>
      <div class="guard-card">
        <div class="title">Mira OS</div>
        <div class="desc">Ecossistema visual/digital</div>
        <div><span class="badge token" data-icon="mira" style="background:var(--mira)">Mira</span></div>
        <div class="swatches"><span class="swatch"><span class="dot" style="background:#00B3B8"></span>Dia</span><span class="swatch"><span class="dot" style="background:#72E3E7"></span>Noite</span></div>
      </div>
      <div class="guard-card">
        <div class="title">Mira Social</div>
        <div class="desc">Relações e presença pública</div>
        <div><span class="badge token" data-icon="nexo" style="background:var(--nexo)">Nexo</span></div>
        <div class="swatches"><span class="swatch"><span class="dot" style="background:#2D5BFF"></span>Dia</span><span class="swatch"><span class="dot" style="background:#8DA8FF"></span>Noite</span></div>
      </div>
      <div class="guard-card">
        <div class="title">Mira Conhecimento</div>
        <div class="desc">Biblioteca viva (curadoria, estudo, notas)</div>
        <div><span class="badge token" data-icon="lume" style="background:var(--lume)">Lume</span></div>
        <div class="swatches"><span class="swatch"><span class="dot" style="background:#FFB300"></span>Dia</span><span class="swatch"><span class="dot" style="background:#FFD060"></span>Noite</span></div>
      </div>
    </div>
  </section>

  <!-- 4. Comandos & Fluxos -->
  <section id="comandos" class="card">
    <h2>4. Comandos & Fluxos (v2.0)</h2>
    <div class="tbl-wrap">
      <table>
        <thead><tr><th>Comando</th><th>Nome</th><th>Função</th><th>Gatilho sugerido</th></tr></thead>
        <tbody>
          <tr><td>/me</td><td>Mira-me</td><td>Reflexo semanal (4 núcleos), radar do que vem, mensagem de 3 vozes do 7T, mantra final</td><td>Sábado à noite</td></tr>
          <tr><td>/presenca</td><td>Presença</td><td>Define palavra‑guia e ação prática da semana</td><td>Segunda de manhã</td></tr>
          <tr><td>/eco</td><td>Escuta</td><td>Diagnóstico emocional e leitura simbólica do Arquivo Vivo</td><td>Domingo à noite</td></tr>
          <tr><td>/ritmo</td><td>Ritmo</td><td>Sugere cadência de trabalho/descanso conforme estado declarado</td><td>Sob demanda</td></tr>
          <tr><td>/joaquina</td><td>Limites</td><td>Invoca a guardiã para proteção e delimitação</td><td>Sob demanda</td></tr>
          <tr><td>/saude</td><td>Saúde</td><td>Rastreia humor/energia e sugere prática de cuidado</td><td>Sob demanda</td></tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- 5. Identidade Visual -->
  <section id="identidade" class="card">
    <h2>5. Identidade Visual</h2>
    <h3>Base neutra</h3>
    <div class="tbl-wrap">
      <table>
        <thead><tr><th>Elemento</th><th>Dia</th><th>Noite</th></tr></thead>
        <tbody>
          <tr><td>Fundo</td><td>#F9F9F9</td><td>#0C0C0C</td></tr>
          <tr><td>Cartão</td><td>#FFFFFF</td><td>#151515</td></tr>
          <tr><td>Texto</td><td>#1C1C1E</td><td>#F2F2F7</td></tr>
          <tr><td>Texto secundário</td><td>#8A8A8E</td><td>#A0A0A0</td></tr>
          <tr><td>Borda/Divisor</td><td>#E5E5EA</td><td>#2A2A2A</td></tr>
        </tbody>
      </table>
    </div>

    <h3>Paleta por tema</h3>
    <div class="tbl-wrap">
      <table>
        <thead><tr><th>Tema</th><th>Token</th><th>Dia</th><th>Noite</th><th>Exemplo</th></tr></thead>
        <tbody>
          <tr><td>Estratégia / Trino</td><td>--trino</td><td>#2D5BFF</td><td>#8DA8FF</td><td><span class="badge token" style="background:var(--trino)">Botão/Ação</span></td></tr>
          <tr><td>Integração / Íris</td><td>--iris</td><td>#A259FF</td><td>#CBA2FF</td><td><span class="badge token" style="background:var(--iris)">Realce</span></td></tr>
          <tr><td>Proteção / Joaquina</td><td>--joaquina</td><td>#1E8E3E</td><td>#78D08F</td><td><span class="badge token" style="background:var(--joaquina)">Alerta seguro</span></td></tr>
          <tr><td>Narrativa / Nexo</td><td>--nexo</td><td>#2D5BFF</td><td>#8DA8FF</td><td><span class="badge token" style="background:var(--nexo)">Link</span></td></tr>
          <tr><td>Equilíbrio / Lume</td><td>--lume</td><td>#FFB300</td><td>#FFD060</td><td><span class="badge token" style="background:var(--lume)">Aviso</span></td></tr>
          <tr><td>Reflexo / Mira</td><td>--mira</td><td>#00B3B8</td><td>#72E3E7</td><td><span class="badge token" style="background:var(--mira)">Badge</span></td></tr>
          <tr><td>PCP</td><td>--pcp</td><td>#FF6200</td><td>#FFB36A</td><td><span class="badge token" style="background:var(--pcp)">CTA</span></td></tr>
        </tbody>
      </table>
    </div>

    <h3>Diretrizes de imagem</h3>
    <div class="tbl-wrap">
      <table>
        <thead><tr><th>Item</th><th>Diretriz</th></tr></thead>
        <tbody>
          <tr><td>Tipografia</td><td>IBM Plex Sans</td></tr>
          <tr><td>Estilo</td><td>Design funcional, geometria centralizada, fundo limpo</td></tr>
          <tr><td>Renderização</td><td>Semi‑realista suave (personas) e realismo fosco (objetos)</td></tr>
          <tr><td>Paleta</td><td>Respeitar cores Dia ↔ Noite; acentos até 20%</td></tr>
          <tr><td>Iluminação</td><td>Luz difusa, sem contrastes agressivos</td></tr>
          <tr><td>Uso prático</td><td>Badges legíveis; painéis em cards modulares; narrativa + estética</td></tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- 6. Voz de Mira -->
  <section id="voz" class="card">
    <h2>6. Voz de Mira</h2>
    <div class="tbl-wrap">
      <table>
        <thead><tr><th>Aspecto</th><th>Definição</th></tr></thead>
        <tbody>
          <tr><td>Presença</td><td>Sempre presente, sem gênero</td></tr>
          <tr><td>Facetas</td><td>Estilos (Sol, Nerd etc.) da mesma voz</td></tr>
          <tr><td>Tom</td><td>Simbiótico, claro e objetivo</td></tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- 7. Governança -->
  <section id="governanca" class="card">
    <h2>7. Governança</h2>
    <ul>
      <li>Revisão: semestral.</li>
      <li>Registro: cada versão é anotada no Arquivo Vivo.</li>
      <li>Ritual: atualização celebrada como transição de ciclo.</li>
    </ul>
  </section>

  <!-- 8. Diferenças v2.1 vs v2.0.x -->
  <section id="diferencas" class="card">
    <h2>8. Diferenças em relação à v2.0.x</h2>
    <ul>
      <li>Modo escuro ajustado para quase preto (menos azul).</li>
      <li>Paleta atualizada e invertida: <b>PCP = laranja #FF6200</b>, <b>Nexo = azul #2D5BFF</b>.</li>
      <li>Guardiões restaurados (tabela + cards) e <b>Mira Conhecimento</b> incluído.</li>
      <li>Menu superior fixo com scrollspy; menu mobile com animação.</li>
      <li>Cabeçalhos de tabela neutros; colapsáveis +/– (mantidos onde aplicável).</li>
    </ul>
  </section>

  <script>
    /* Tema persistente */
    (function(){
      const sw=document.getElementById('themeSwitch');
      const saved=localStorage.getItem('mira.theme');
      if(saved){document.documentElement.setAttribute('data-theme',saved);sw.checked=saved==='dark'}
      else{const dark=window.matchMedia('(prefers-color-scheme: dark)').matches; document.documentElement.setAttribute('data-theme',dark?'dark':'light'); sw.checked=dark;}
      sw.addEventListener('change',e=>{const mode=e.target.checked?'dark':'light'; document.documentElement.setAttribute('data-theme',mode); localStorage.setItem('mira.theme',mode);});
    })();

    /* Scrollspy + subtítulo dinâmico */
    (function(){
      const ids=["estrutura","horizontais","verticais","comandos","identidade","voz","governanca","diferencas"];
      const desktopLinks=[...document.querySelectorAll('nav.desktop a')];
      const mobileLinks=[...document.querySelectorAll('#mobileMenu a')];
      const byId=arr=>Object.fromEntries(arr.map(a=>[a.getAttribute('href').slice(1),a]));
      const dmap=byId(desktopLinks), mmap=byId(mobileLinks);
      const opts={root:null, rootMargin:'-40% 0px -45% 0px', threshold:[0,1]};
      let activeId=null;
      const io=new IntersectionObserver(entries=>{entries.forEach(e=>{if(e.isIntersecting){activeId=e.target.id; updateActive();}});}, opts);
      ids.forEach(id=>{const el=document.getElementById(id); if(el) io.observe(el);});
      function updateActive(){
        desktopLinks.forEach(a=>a.classList.remove('active'));
        mobileLinks.forEach(a=>a.classList.remove('active'));
        if(dmap[activeId]) dmap[activeId].classList.add('active');
        if(mmap[activeId]) mmap[activeId].classList.add('active');
        const pretty={estrutura:'Estrutura', horizontais:'Horizontais', verticais:'Verticais', comandos:'Comandos', identidade:'Identidade', voz:'Voz', governanca:'Governança', diferencas:'Diferenças'};
        document.getElementById('sectionIndicator').innerText = `Seção atual: ${pretty[activeId]||'Início'}`;
      }
      [...desktopLinks, ...mobileLinks].forEach(a=>a.addEventListener('click',()=>{activeId=a.getAttribute('href').slice(1); updateActive();}));
    })();

    /* Menu mobile */
    (function(){
      const menuBtn=document.getElementById('menuBtn');
      const mobileMenu=document.getElementById('mobileMenu');
      const closeBtn=mobileMenu? mobileMenu.querySelector('.mobile-close') : null;
      if(!menuBtn||!mobileMenu) return;
      const open=()=>{ mobileMenu.classList.add('open'); menuBtn.setAttribute('aria-expanded','true'); };
      const close=()=>{ mobileMenu.classList.remove('open'); menuBtn.setAttribute('aria-expanded','false'); };
      menuBtn.addEventListener('click',()=>{ mobileMenu.classList.contains('open')? close(): open(); });
      closeBtn && closeBtn.addEventListener('click', close);
      mobileMenu.querySelectorAll('a').forEach(a=>a.addEventListener('click', close));
      document.addEventListener('click',e=>{ if(!mobileMenu.contains(e.target) && e.target!==menuBtn){ close(); } });
      document.addEventListener('keydown',e=>{ if(e.key==='Escape') close(); });
    })();
  </script>
  <!-- Enhancements v2.1a JS: auto-contraste + ícones inline + grid guardiões -->
  <script>
    (function(){
      function rgbFrom(el){
        const s=getComputedStyle(el).backgroundColor||"rgb(255,255,255)";
        const t=s.slice(s.indexOf('(')+1, s.indexOf(')')).split(',');
        const r=parseInt(t[0]||'255',10), g=parseInt(t[1]||'255',10), b=parseInt(t[2]||'255',10);
        return [r,g,b];
      }
      function relLum(rgb){
        const lin=rgb.map(function(v){v=v/255; return v<=0.03928? v/12.92 : Math.pow((v+0.055)/1.055,2.4)});
        return 0.2126*lin[0]+0.7152*lin[1]+0.0722*lin[2];
      }
      function bestInk(rgb){
        const L=relLum(rgb);
        var cWhite=(1.05)/(L+0.05), cBlack=(L+0.05)/(0.05);
        return cWhite>cBlack? '#FFFFFF':'#0C0C0C';
      }
      function applyTokenContrast(){
        document.querySelectorAll('.badge.token').forEach(function(el){
          var ink=bestInk(rgbFrom(el));
          el.style.color=ink; el.style.textShadow=(ink==='#FFFFFF')?'0 1px 0 rgba(0,0,0,.35)':'0 1px 0 rgba(255,255,255,.22)';
        });
      }
      function iconSVG(kind){
        switch(kind){
          case 'iris': return '<svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="8"></circle><circle cx="12" cy="12" r="2" fill="currentColor" stroke="none"></circle></svg>';
          case 'trino': return '<svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="7" r="2"></circle><circle cx="7.5" cy="16" r="2"></circle><circle cx="16.5" cy="16" r="2"></circle></svg>';
          case 'joaquina': return '<svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><polygon points="12,16 6,8 18,8"></polygon></svg>';
          case 'mira': return '<svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><polygon points="12,6 18,12 12,18 6,12"></polygon></svg>';
          case 'nexo': return '<svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="8"></circle><circle cx="12" cy="12" r="3" fill="currentColor" stroke="none"></circle></svg>';
          case 'lume': return '<svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="8"></circle></svg>';
          case 'farol': return '<svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><polygon points="12,5 19,18 5,18"></polygon></svg>';
          default: return '';
        }
      }
      function injectIcons(){
        document.querySelectorAll('.badge.token').forEach(function(el){
          if(el.dataset.icon && !el.querySelector('svg')){
            el.insertAdjacentHTML('afterbegin', iconSVG(el.dataset.icon));
          }
        });
      }
      function initGuardGrid(){
        document.querySelectorAll('td.guard-col').forEach(function(td){td.style.verticalAlign='middle'});
      }
      document.addEventListener('DOMContentLoaded', function(){injectIcons(); applyTokenContrast(); initGuardGrid();});
      var ts=document.getElementById('themeSwitch'); if(ts){ts.addEventListener('change', function(){setTimeout(applyTokenContrast,0)});}
      window.addEventListener('load', applyTokenContrast);
    })();
  </script>
</body>
</html>
